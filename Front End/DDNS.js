$(document).ready(function () {
	const ddnsContractAddress = "0x8bf5bb3103beec1037e6da3f2741e7f9a123df8b";
	
	const ddnsContractABI = [
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "DomainList",
		"outputs": [
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "IP",
				"type": "string"
			},
			{
				"name": "owner",
				"type": "address"
			},
			{
				"name": "lockTime",
				"type": "uint256"
			},
			{
				"name": "infoDocumentHash",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "TransferDomain",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "IP",
				"type": "string"
			}
		],
		"name": "EditDomain",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "hash",
				"type": "string"
			}
		],
		"name": "AddDomainInfoDocument",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "IP",
				"type": "string"
			}
		],
		"name": "RegisterDomain",
		"outputs": [],
		"payable": true,
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "ContractOwnerWithdraw",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "name",
				"type": "string"
			}
		],
		"name": "GetDomainInfo",
		"outputs": [
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "address"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "contractOwner",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "GetContractBalance",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "timeDuration",
				"type": "uint256"
			}
		],
		"name": "NewDomainRegisteredLog",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": false,
				"name": "timeDuration",
				"type": "uint256"
			}
		],
		"name": "DomainTransferLog",
		"type": "event"
	}
];
	//--------------
	// var Web3 = require("web3");
	// var web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));

	// var acc = web3.eth.accounts[0]; //get the first account
	// const bytecode = "60806040523480156200001157600080fd5b5060008054600160a060020a031916331790556040805180820190915260058082527f656d70747900000000000000000000000000000000000000000000000000000060209092019182526200006a9160019162000272565b506040805180820190915260038082527f6e2f6100000000000000000000000000000000000000000000000000000000006020909201918252620000b19160029162000272565b5060038054600160a060020a03191681556000600455604080518082019091528181527f6e2f61000000000000000000000000000000000000000000000000000000000060209091019081526200010c916005919062000272565b506000600660016000016040518082805460018160011615610100020316600290048015620001755780601f106200015257610100808354040283529182019162000175565b820191906000526020600020905b81548152906001019060200180831162000160575b5050928352505060405190819003602001902055600780546001818101808455600093909352805490916005027fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c6880190620001e69082908490600261010082841615026000190190911604620002f7565b506001820181600101908054600181600116156101000203166002900462000210929190620002f7565b506002828101548282018054600160a060020a031916600160a060020a0390921691909117905560038084015490830155600480840180546200026893928501926001821615610100026000190190911604620002f7565b5050505062000391565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620002b557805160ff1916838001178555620002e5565b82800160010185558215620002e5579182015b82811115620002e5578251825591602001919060010190620002c8565b50620002f392915062000371565b5090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620003325780548555620002e5565b82800160010185558215620002e557600052602060002091601f016020900482015b82811115620002e557825482559160010191906001019062000354565b6200038e91905b80821115620002f3576000815560010162000378565b90565b611d1f80620003a16000396000f3006080604052600436106100985763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166301edb7b3811461009d5780630288c0a01461021957806327b7d0a61461027f5780635160a21e14610316578063706b5759146103ad5780639c75620014610437578063a727390d1461044f578063ce606ee0146104a8578063f6d0bf2f146104d9575b600080fd5b3480156100a957600080fd5b506100b5600435610500565b60405180806020018060200186600160a060020a0316600160a060020a0316815260200185815260200180602001848103845289818151815260200191508051906020019080838360005b83811015610118578181015183820152602001610100565b50505050905090810190601f1680156101455780820380516001836020036101000a031916815260200191505b5084810383528851815288516020918201918a019080838360005b83811015610178578181015183820152602001610160565b50505050905090810190601f1680156101a55780820380516001836020036101000a031916815260200191505b50848103825285518152855160209182019187019080838360005b838110156101d85781810151838201526020016101c0565b50505050905090810190601f1680156102055780820380516001836020036101000a031916815260200191505b509850505050505050505060405180910390f35b34801561022557600080fd5b506040805160206004803580820135601f810184900484028501840190955284845261027d94369492936024939284019190819084018382808284375094975050509235600160a060020a031693506106f992505050565b005b34801561028b57600080fd5b506040805160206004803580820135601f810184900484028501840190955284845261027d94369492936024939284019190819084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979a999881019791965091820194509250829150840183828082843750949750610af09650505050505050565b34801561032257600080fd5b506040805160206004803580820135601f810184900484028501840190955284845261027d94369492936024939284019190819084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979a999881019791965091820194509250829150840183828082843750949750610d9c9650505050505050565b6040805160206004803580820135601f810184900484028501840190955284845261027d94369492936024939284019190819084018382808284375050604080516020601f89358b018035918201839004830284018301909452808352979a9998810197919650918201945092508291508401838280828437509497506110429650505050505050565b34801561044357600080fd5b5061027d6004356116f4565b34801561045b57600080fd5b506040805160206004803580820135601f81018490048402850184019095528484526100b59436949293602493928401919081908401838280828437509497506118399650505050505050565b3480156104b457600080fd5b506104bd611b83565b60408051600160a060020a039092168252519081900360200190f35b3480156104e557600080fd5b506104ee611b92565b60408051918252519081900360200190f35b600780548290811061050e57fe5b60009182526020918290206005919091020180546040805160026001841615610100026000190190931692909204601f8101859004850283018501909152808252919350918391908301828280156105a75780601f1061057c576101008083540402835291602001916105a7565b820191906000526020600020905b81548152906001019060200180831161058a57829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156106455780601f1061061a57610100808354040283529160200191610645565b820191906000526020600020905b81548152906001019060200180831161062857829003601f168201915b5050505060028381015460038501546004860180546040805160206101006001851615026000190190931696909604601f81018390048302870183019091528086529697600160a060020a03909416969295509293929091908301828280156106ef5780601f106106c4576101008083540402835291602001916106ef565b820191906000526020600020905b8154815290600101906020018083116106d257829003601f168201915b5050505050905085565b8133600160a060020a031660076006836040518082805190602001908083835b602083106107385780518252601f199092019160209182019101610719565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061077357fe5b6000918252602090912060026005909202010154600160a060020a03161461080b576040805160e560020a62461bcd02815260206004820152602a60248201527f4572726f723a20596f7520617265206e6f7420616e206f776e6572206f66207460448201527f686520646f6d61696e2e00000000000000000000000000000000000000000000606482015290519081900360840190fd5b600060076006836040518082805190602001908083835b602083106108415780518252601f199092019160209182019101610822565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061087c57fe5b90600052602060002090600502016003015411151561090b576040805160e560020a62461bcd02815260206004820152603060248201527f4572726f723a20596f7572206f776e657273686970206f662074686520646f6d60448201527f61696e2068617320657870697265642e00000000000000000000000000000000606482015290519081900360840190fd5b8160076006856040518082805190602001908083835b602083106109405780518252601f199092019160209182019101610921565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061097b57fe5b906000526020600020906005020160020160006101000a815481600160a060020a030219169083600160a060020a031602179055507f22c66cb5b52d305f2176cc4e92c2c8028dbbeb2e445fac49394ace7410b3da18838360076006876040518082805190602001908083835b60208310610a075780518252601f1990920191602091820191016109e8565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610a4257fe5b906000526020600020906005020160030154604051808060200184600160a060020a0316600160a060020a03168152602001838152602001828103825285818151815260200191508051906020019080838360005b83811015610aaf578181015183820152602001610a97565b50505050905090810190601f168015610adc5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a1505050565b8133600160a060020a031660076006836040518082805190602001908083835b60208310610b2f5780518252601f199092019160209182019101610b10565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610b6a57fe5b6000918252602090912060026005909202010154600160a060020a031614610c02576040805160e560020a62461bcd02815260206004820152602a60248201527f4572726f723a20596f7520617265206e6f7420616e206f776e6572206f66207460448201527f686520646f6d61696e2e00000000000000000000000000000000000000000000606482015290519081900360840190fd5b600060076006836040518082805190602001908083835b60208310610c385780518252601f199092019160209182019101610c19565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610c7357fe5b906000526020600020906005020160030154111515610d02576040805160e560020a62461bcd02815260206004820152603060248201527f4572726f723a20596f7572206f776e657273686970206f662074686520646f6d60448201527f61696e2068617320657870697265642e00000000000000000000000000000000606482015290519081900360840190fd5b8160076006856040518082805190602001908083835b60208310610d375780518252601f199092019160209182019101610d18565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610d7257fe5b90600052602060002090600502016001019080519060200190610d96929190611c22565b50505050565b8133600160a060020a031660076006836040518082805190602001908083835b60208310610ddb5780518252601f199092019160209182019101610dbc565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610e1657fe5b6000918252602090912060026005909202010154600160a060020a031614610eae576040805160e560020a62461bcd02815260206004820152602a60248201527f4572726f723a20596f7520617265206e6f7420616e206f776e6572206f66207460448201527f686520646f6d61696e2e00000000000000000000000000000000000000000000606482015290519081900360840190fd5b600060076006836040518082805190602001908083835b60208310610ee45780518252601f199092019160209182019101610ec5565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054835490925082109050610f1f57fe5b906000526020600020906005020160030154111515610fae576040805160e560020a62461bcd02815260206004820152603060248201527f4572726f723a20596f7572206f776e657273686970206f662074686520646f6d60448201527f61696e2068617320657870697265642e00000000000000000000000000000000606482015290519081900360840190fd5b8160076006856040518082805190602001908083835b60208310610fe35780518252601f199092019160209182019101610fc4565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061101e57fe5b90600052602060002090600502016004019080519060200190610d96929190611c22565b61104a611ca0565b8260608190506004815110156110aa576040805160e560020a62461bcd02815260206004820152601d60248201527f4572726f723a20446f6d61696e206e616d6520746f6f2073686f72742e000000604482015290519081900360640190fd5b670de0b6b3a7640000341015611130576040805160e560020a62461bcd02815260206004820152602660248201527f4572726f723a2054686520646f6d61696e206e616d652070726963652069732060448201527f31204554482e0000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60076006866040518082805190602001908083835b602083106111645780518252601f199092019160209182019101611145565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061119f57fe5b6000918252602090912060059091020160020154600160a060020a0316331415611256576301e1338060076006876040518082805190602001908083835b602083106111fc5780518252601f1990920191602091820191016111dd565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061123757fe5b60009182526020909120600360059092020101805490910190556114d6565b4260076006876040518082805190602001908083835b6020831061128b5780518252601f19909201916020918201910161126c565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220548354909250821090506112c657fe5b906000526020600020906005020160030154101515611355576040805160e560020a62461bcd02815260206004820152602b60248201527f4572726f723a2054686520646f6d61696e206973206f776e656420627920736f60448201527f6d656f6e6520656c73652e000000000000000000000000000000000000000000606482015290519081900360840190fd5b60075460405186516006918891819060208401908083835b6020831061138c5780518252601f19909201916020918201910161136d565b51815160001960209485036101000a019081169019919091161790529201948552506040805194859003820190942094909455505086855284820186905233858201526301e13380420160608601528051808201909152600d81527f4e6f7420417661696c61626c65000000000000000000000000000000000000008183015260808501526007805460018101808355600092909252855180519293879360059093027fa66cc928b5edb82af9bd49922954155ab7b0942694bea4ce44661d9a8736c688019261145f9284920190611c22565b5060208281015180516114789260018501920190611c22565b50604082015160028201805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a0390921691909117905560608201516003820155608082015180516114d1916004840191602090910190611c22565b505050505b670de0b6b3a764000034111561151f576040513390670de0b6b3a763ffff19340180156108fc02916000818181858888f1935050505015801561151d573d6000803e3d6000fd5b505b7feed21c66505590e6169bbee9856c64783882f97ae02bd2ae9334dc6ed5c704878560076006886040518082805190602001908083835b602083106115755780518252601f199092019160209182019101611556565b51815160209384036101000a60001901801990921691161790529201948552506040519384900301909220548354909250821090506115b057fe5b906000526020600020906005020160020160009054906101000a9004600160a060020a031660076006896040518082805190602001908083835b602083106116095780518252601f1990920191602091820191016115ea565b51815160209384036101000a600019018019909216911617905292019485525060405193849003019092205483549092508210905061164457fe5b906000526020600020906005020160030154604051808060200184600160a060020a0316600160a060020a03168152602001838152602001828103825285818151815260200191508051906020019080838360005b838110156116b1578181015183820152602001611699565b50505050905090810190601f1680156116de5780820380516001836020036101000a031916815260200191505b5094505050505060405180910390a15050505050565b600054600160a060020a0316331461177c576040805160e560020a62461bcd02815260206004820152602660248201527f4572726f723a20596f7520617265206e6f742074686520636f6e74726163742060448201527f6f776e65722e0000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b60008111801561178c5750303181105b1515611808576040805160e560020a62461bcd02815260206004820152603560248201527f4572726f723a2052657175697265642076616c7565206973206269676765722060448201527f7468616e206578697374696e6720616d6f756e742e0000000000000000000000606482015290519081900360840190fd5b604051339082156108fc029083906000818181858888f19350505050158015611835573d6000803e3d6000fd5b5050565b606080600080606060008660608190506004815110156118a3576040805160e560020a62461bcd02815260206004820152601d60248201527f4572726f723a20446f6d61696e206e616d6520746f6f2073686f72742e000000604482015290519081900360640190fd5b6006896040518082805190602001908083835b602083106118d55780518252601f1990920191602091820191016118b6565b51815160209384036101000a6000190180199092169116179052920194855250604051938490030190922054600780549196509250859150811061191557fe5b906000526020600020906005020160000160078481548110151561193557fe5b906000526020600020906005020160010160078581548110151561195557fe5b600091825260209091206002600590920201015460078054600160a060020a03909216918790811061198357fe5b9060005260206000209060050201600301546007878154811015156119a457fe5b9060005260206000209060050201600401848054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015611a4a5780601f10611a1f57610100808354040283529160200191611a4a565b820191906000526020600020905b815481529060010190602001808311611a2d57829003601f168201915b5050875460408051602060026001851615610100026000190190941693909304601f8101849004840282018401909252818152959a5089945092508401905082828015611ad85780601f10611aad57610100808354040283529160200191611ad8565b820191906000526020600020905b815481529060010190602001808311611abb57829003601f168201915b5050845460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815295995086945092508401905082828015611b665780601f10611b3b57610100808354040283529160200191611b66565b820191906000526020600020905b815481529060010190602001808311611b4957829003601f168201915b505050505090509750975097509750975050505091939590929450565b600054600160a060020a031681565b60008054600160a060020a03163314611c1b576040805160e560020a62461bcd02815260206004820152602660248201527f4572726f723a20596f7520617265206e6f742074686520636f6e74726163742060448201527f6f776e65722e0000000000000000000000000000000000000000000000000000606482015290519081900360840190fd5b5030315b90565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10611c6357805160ff1916838001178555611c90565b82800160010185558215611c90579182015b82811115611c90578251825591602001919060010190611c75565b50611c9c929150611cd9565b5090565b60a06040519081016040528060608152602001606081526020016000600160a060020a0316815260200160008152602001606081525090565b611c1f91905b80821115611c9c5760008155600101611cdf5600a165627a7a7230582031274c72fee2173dac828fb11e06fac5b00ee0d9b23085a0cd21a2a381e5b6df0029"
	// var Contract = web3.eth.contract(abi);
	// var publishData = {
	// "from": acc, //the account from which it will be published
	// "data": bytecode,
	// "gas": 4000000 //gas limit. This should be the same or lower than Ethereum's gas limit
	// }
	// Contract.new(publishData, function(err, contractInstance) {
	// if(!err) {
		// if(contractInstance.address) { //if the contract has an address aka if the transaction is mined
			// console.log("New contract address is :", contractInstance.address);
		// }
	// } else {
		// console.error(err); //something went wrong
	// }
	// });
	// const ddnsContractAddress = contractInstance.address;
	//---------------

	const IPFS = window.IpfsApi({host: "localhost", port: 5001, protocol: "https"});
	const Buffer = IPFS.Buffer;
	
	$('#linkHome').click(function () {
		showView("viewHome");
	});
	
	$('#linkGetDomainInfo').click(function () {
		$('#textareaDomainName').val('');
		showView("viewGetDomainInfo");	
	});

	$('#linkRegisterDomain').click(function () {
		$('#textareaDomainNameRegister').val('');
		$('#textareaDomainIP').val('');
		$('#textareaETH').val('');
		showView("viewRegisterDomain");
    });
	
	$('#linkEditDomainIP').click(function () {
		$('#textareaDomainNameEdit').val('');
		$('#textareaNewIP').val('');
		showView("viewEditDomainIP");    
	});
	
	$('#linkTransferDomain').click(function () {
		$('#textareaDomainNameTransfer').val('');
		$('#textareaNewOwner').val('');
		showView("viewTransferDomain");    
	});

	$('#linkUploadDomainDocument').click(function () {
		$('#textareaDomainNameUpload').val('');
		$('#documentForUpload').val('');
		showView("viewUploadDomainDocument");
	});
	
	$('#linkContractBalance').click(function () {
		$('#textareaBalance').val('');
		$('#textareaAmount').val('');
		showView("viewContractBalance");
		
	});
	
	$('#buttonQueryDomainName').click(GetDomainInfo);
	$('#buttonRegisterDomain').click(RegisterDomain);
	$('#buttonEditDomain').click(EditDomainIP);
	$('#buttonTransferDomain').click(TransferDomain);
	$('#documentUploadButton').click(UploadDomainDocument);
	$('#buttonWithdraw').click(ContractOwnerWithdraw);
	$('#buttonBalance').click(GetContractBalance);

	// Attach AJAX "loading" event listener
	$(document).on({
    ajaxStart: function () {
        $("#loadingBox").show()
    },
    ajaxStop: function () {
        $("#loadingBox").hide()
    }
	});

	function showView(viewName) {
    // Hide all views and show the selected view only
    $('main > section').hide();
    $('#' + viewName).show();
	}

	function showInfo(message) {
    $('#infoBox>p').html(message);
    $('#infoBox').show();
    $('#infoBox>header').click(function () {
        $('#infoBox').hide();
    });
	}

	function showError(errorMsg) {
    $('#errorBox>p').html("Error: " + errorMsg);
    $('#errorBox').show();
    $('#errorBox>header').click(function () {
        $('#errorBox').hide();
    });
	}

	function GetDomainInfo() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
	
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
		contract.GetDomainInfo($('#textareaDomainName').val(), function (err, result) {
			if (err)
				return showError("Smart contract call failed: " + err);
			
			let domainName = result[0];
			let domainIP = result[1];
			let domainOwner = result[2];
			let domainLockTime = result[3];
			let ipfsHash = result[4];
			let div = $('<div>');
			//let url = 'https://ipfs.io/ipfs/' + ipfsHash;
			//let url = 'https://ipfs.io/ipfs/QmPnh58j7658eXzcA9tNBmMi6CxeY1ZojTQv9mpT8xUiBk';
			let displayDate = new Date(domainLockTime * 1000).toLocaleString();
			
			$('#textareaDomainNameResult').val(domainName);
			$('#textareaDomainIPResult').val(domainIP);
			$('#textareaDomainOwnerResult').val(domainOwner);
			$('#textareaDomainValidityTime').val(displayDate);
			$('#textareaDomainInfoDocumentHash').val(ipfsHash);
			
			//$(`<img src="${url}" />`);
						
			//div
			//	.append($(`<img src="${url}" />`));

		});
		//html.append('</div>');
		//$('#viewGetDomainInfo').append(html);
	}
	
	function RegisterDomain() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
	
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
		contract.RegisterDomain($('#textareaDomainNameRegister').val(), $('#textareaDomainIP').val(), { value: ($('#textareaETH').val()*1000000000000000000) }, function (err, txHash) {
			if (err)
				return showError("Smart contract call failed: " + err);
			else			
				showInfo(`Domain <b>successfully registered</b>. Transaction hash: ${txHash}`);
		});
	}
	
	function EditDomainIP() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
		
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);				
			contract.EditDomain($('#textareaDomainNameEdit').val(), $('#textareaNewIP').val(), { gas: 100000 }, function (err, txHash) {
			//contract.EditDomain('pesho.com', 'test', { gas: 100000 }, function (err, txHash) {
			if (err)
				return showError("Smart contract call failed: " + err);
			else			
				showInfo(`Domain IP <b>successfully updated</b>. Transaction hash: ${txHash}`);				
		});
	}
	
	function TransferDomain() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
	
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
		contract.TransferDomain($('#textareaDomainNameTransfer').val(), $('#textareaNewOwner').val(), function (err, txHash) {
			if (err)
				return showError("Smart contract call failed: " + err);
			else			
				showInfo(`Domain owner <b>successfully updated</b>. Transaction hash: ${txHash}`);
		});
	}
	
	function UploadDomainDocument() {
		if($('#documentForUpload')[0].files.length === 0) {
			return showError("Please select a file to upload.");
		}
		let fileReader = new FileReader();
		fileReader.onload = function() {
			if(typeof web3 === 'undefined')
				return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
			let fileBuffer = Buffer.from(fileReader.result);
			
			let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
			IPFS.files.add(fileBuffer, (err, result) => {
				if (err)
					return showError (err);
				
				let ipfsHash = result[0].hash;
				contract.AddDomainInfoDocument($('#textareaDomainNameUpload').val(), ipfsHash, function (err, txHash) {
					if (err)
						return showError("Smart contract call failed: " + err);
					showInfo(`Document ${ipfsHash} <b>successfully uploaded</b> to the domain. Transaction hash: ${txHash}`);
				});
			});			
		};
		fileReader.readAsArrayBuffer($('#documentForUpload')[0].files[0]);	
	}
	
	function GetContractBalance() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
	
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
		contract.GetContractBalance( function (err, result) {
			if (err)
				return showError("Smart contract call failed: " + err);
			
			let balance = result;
			$('#textareaBalance').val(balance/1000000000000000000);
		});
	}
	
	function ContractOwnerWithdraw() {
		if(typeof web3 === 'undefined')
			return showError("Please install MetaMask to access the Ethereum Web3 API from your web browser.");
	
		let contract = web3.eth.contract(ddnsContractABI).at(ddnsContractAddress);
		
		contract.ContractOwnerWithdraw(($('#textareaAmount').val()*1000000000000000000), function (err, txHash) {
			if (err)
				return showError("Smart contract call failed: " + err);
						
			showInfo(`Amount <b>successfully transferred</b>. Transaction hash: ${txHash}`);
		});
	}
	
});

